#!/usr/bin/env groovy
/*
 * Forkfile
 * gradle-xcodePlugin
 */

node {
    stage("🛒 Checkout") {
        checkout scm
        sh "cd .fork && pwd && ls -la"
        sh "mkdir -p .fork/build/dependencies"
        sh "cd .fork/build/dependencies && git clone git@github.com:phatblat/Fork.git"
    }
    stage("⏫ Update") {
        gradle "projects"
    }
}

void gradle(String command) {
    sh """.fork/gradlew \
        --no-daemon \
        --build-file .fork/build.gradle.kts \
        --settings-file settings.gradle.kts \
        --warning-mode all \
        $command
    """
}
